<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæ–‡å­—å¤„ç†</title>
    <link rel="icon" type="image/x-icon" href="../favicon.ico">
    <link rel="stylesheet" href="../style sheet.css">
    <style>
        *, *::before, *::after {
        box-sizing: border-box;
        user-select: text;
        }
    </style>
</head>
<body>
    <a href="../index.html" class="">
        <div class="logo">
            <img src="../Icon/Logo2.jpg" width="60px" alt="çŸå–†ç”Ÿç‰©">
            <ul>
                <li>WZ</li>
                <li>Biotech</li>
            </ul>
        </div>
    </a>
    <div class="title">
        AIæ–‡å­—å¤„ç†
        <a href="./Knowledge catalogue.html"><img src="../Icon/Experiment.jpg" height="78px" alt="è¿”å›å®éªŒèœå•"></a>
    </div>

    <div class="container">
        <div class="main-content">
            <div class="input-section">
                <h2>è¾“å…¥æ–‡æœ¬</h2>
                <textarea id="input-text" placeholder="è¯·è¾“å…¥ä¸­æ–‡æˆ–è‹±æ–‡æ–‡æœ¬ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è¯†åˆ«å¹¶ç¿»è¯‘..."></textarea>
                <div id="input-language" class="language-info">
                    <span class="language-flag">ğŸŒ</span>
                    <span id="input-lang-text">ç­‰å¾…æ£€æµ‹è¾“å…¥è¯­è¨€...</span>
                </div>
                <div class="controls">
                    <div class="button-group">
                        <button id="translate-btn">è‡ªåŠ¨ç¿»è¯‘</button>
                        <button id="paraphrase-btn">å­¦æœ¯è½¬è¿°</button>
                        <button id="clear-btn">æ¸…ç©º</button>
                    </div>
                </div>
                <div class="shortcut-hint">æç¤º: æŒ‰ Ctrl+Enter å¿«é€Ÿç¿»è¯‘ï¼ŒCtrl+Shift+Enter å¿«é€Ÿè½¬è¿°</div>
            </div>

            <div class="output-section">
                <h2>å¤„ç†ç»“æœ</h2>
                <div id="output-display" class="output-display">
                    å¤„ç†ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
                </div>
                <div id="output-language" class="language-info">
                    <span class="language-flag">ğŸŒ</span>
                    <span id="output-lang-text">ç­‰å¾…å¤„ç†ç»“æœ...</span>
                </div>
            </div>
        </div>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p id="loading-text">æ­£åœ¨å¤„ç†ï¼Œè¯·ç¨å€™...</p>
        </div>

        <div id="error-message" class="error"></div>
        <div id="success-message" class="success"></div>

        <footer>
            Powered by DeepSeek | Response is AI-generated, for reference only<br>
            å¦‚æœ‰ç–‘é—®è¯·å‘é€é‚®ä»¶è‡³<a href="mailto:service@wzbiotech.cn">service@wzbiotech.cn</a><br>
            &copy;ä¸Šæµ·çŸå–†ç”Ÿç‰©ç§‘æŠ€æœ‰é™å…¬å¸ <br>
            åœ°å€ï¼šä¸Šæµ·å¸‚é’æµ¦åŒºå…¬å›­è·¯348å·7å±‚
        </footer>
    </div>

    <script>
        // AIæ–‡å­—å¤„ç† - æœ€ç»ˆç‰ˆæœ¬ï¼ˆå·²ä¿®å¤å‚æ•°ä¼ é€’é—®é¢˜ï¼‰
        const CLOUD_FUNCTION_CONFIG = {
            HTTP_URL: 'https://fc-mp-cebc99d5-4fe8-4142-8c86-23b8f6dc1e7c.next.bspapp.com/deepseek-api'
        };

        // è¯­è¨€ä»£ç æ˜ å°„
        const LANGUAGE_MAP = {
            'en': { 
                name: 'è‹±è¯­', 
                flag: 'ğŸ‡ºğŸ‡¸', 
                target: 'zh',
                targetName: 'ä¸­æ–‡',
                targetFlag: 'ğŸ‡¨ğŸ‡³'
            },
            'zh': { 
                name: 'ä¸­æ–‡', 
                flag: 'ğŸ‡¨ğŸ‡³', 
                target: 'en',
                targetName: 'è‹±è¯­',
                targetFlag: 'ğŸ‡ºğŸ‡¸'
            },
            'ja': { 
                name: 'æ—¥è¯­', 
                flag: 'ğŸ‡¯ğŸ‡µ', 
                target: 'zh',
                targetName: 'ä¸­æ–‡',
                targetFlag: 'ğŸ‡¨ğŸ‡³'
            },
            'ko': { 
                name: 'éŸ©è¯­', 
                flag: 'ğŸ‡°ğŸ‡·', 
                target: 'zh',
                targetName: 'ä¸­æ–‡',
                targetFlag: 'ğŸ‡¨ğŸ‡³'
            },
            'fr': { 
                name: 'æ³•è¯­', 
                flag: 'ğŸ‡«ğŸ‡·', 
                target: 'zh',
                targetName: 'ä¸­æ–‡',
                targetFlag: 'ğŸ‡¨ğŸ‡³'
            },
            'de': { 
                name: 'å¾·è¯­', 
                flag: 'ğŸ‡©ğŸ‡ª', 
                target: 'zh',
                targetName: 'ä¸­æ–‡',
                targetFlag: 'ğŸ‡¨ğŸ‡³'
            },
            'es': { 
                name: 'è¥¿ç­ç‰™è¯­', 
                flag: 'ğŸ‡ªğŸ‡¸', 
                target: 'zh',
                targetName: 'ä¸­æ–‡',
                targetFlag: 'ğŸ‡¨ğŸ‡³'
            },
            'ru': { 
                name: 'ä¿„è¯­', 
                flag: 'ğŸ‡·ğŸ‡º', 
                target: 'zh',
                targetName: 'ä¸­æ–‡',
                targetFlag: 'ğŸ‡¨ğŸ‡³'
            }
        };

        // DOMå…ƒç´ 
        const inputText = document.getElementById('input-text');
        const outputDisplay = document.getElementById('output-display');
        const translateBtn = document.getElementById('translate-btn');
        const paraphraseBtn = document.getElementById('paraphrase-btn');
        const clearBtn = document.getElementById('clear-btn');
        const loading = document.getElementById('loading');
        const loadingText = document.getElementById('loading-text');
        const errorMessage = document.getElementById('error-message');
        const successMessage = document.getElementById('success-message');
        const inputLangText = document.getElementById('input-lang-text');
        const outputLangText = document.getElementById('output-lang-text');

        // è‡ªåŠ¨è¯­è¨€æ£€æµ‹å‡½æ•°
        function detectLanguage(text) {
            if (!text || text.trim().length < 2) return 'en';
            
            try {
                const chineseCharCount = (text.match(/[\u4e00-\u9fa5]/g) || []).length;
                const totalChars = text.length;
                return chineseCharCount > totalChars * 0.3 ? 'zh' : 'en';
            } catch (error) {
                console.error('è¯­è¨€æ£€æµ‹é”™è¯¯:', error);
                return 'en';
            }
        }

        // æ›´æ–°è¯­è¨€æ˜¾ç¤º
        function updateLanguageDisplay(sourceLangCode, isParaphrase = false) {
            const sourceLangInfo = LANGUAGE_MAP[sourceLangCode] || LANGUAGE_MAP['en'];
            inputLangText.textContent = `æ£€æµ‹åˆ°: ${sourceLangInfo.flag} ${sourceLangInfo.name}`;
            
            if (isParaphrase) {
                outputLangText.textContent = `è½¬è¿°ä¸º: ${sourceLangInfo.flag} ${sourceLangInfo.name}`;
            } else {
                const targetLangCode = sourceLangInfo.target;
                const targetLangInfo = LANGUAGE_MAP[targetLangCode] || LANGUAGE_MAP['zh'];
                outputLangText.textContent = `ç¿»è¯‘ä¸º: ${targetLangInfo.flag} ${targetLangInfo.name}`;
            }
        }

        // è°ƒç”¨äº‘å‡½æ•° - ä¿®å¤ç‰ˆ
        async function callCloudFunction(text, action, sourceLang, targetLang) {
            if (!CLOUD_FUNCTION_CONFIG.HTTP_URL) {
                throw new Error('äº‘å‡½æ•°URLæœªé…ç½®');
            }

            console.log('è°ƒç”¨äº‘å‡½æ•°:', { text, action, sourceLang, targetLang });
            
            try {
                // æ„å»ºä¸EMASè°ƒè¯•å™¨ç›¸åŒçš„è¯·æ±‚æ ¼å¼
                const requestBody = {
                    text: text,
                    action: action,
                    sourceLang: sourceLang,
                    targetLang: targetLang
                };

                console.log('å‘é€çš„è¯·æ±‚ä½“:', JSON.stringify(requestBody, null, 2));
                
                const response = await fetch(CLOUD_FUNCTION_CONFIG.HTTP_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTPè¯·æ±‚å¤±è´¥: ${response.status} - ${errorText}`);
                }

                const data = await response.json();
                console.log('äº‘å‡½æ•°è¿”å›åŸå§‹æ•°æ®:', data);
                
                // ç›´æ¥è¿”å›dataï¼Œå› ä¸ºäº‘å‡½æ•°å·²ç»è¿”å›äº†å®Œæ•´çš„å“åº”ç»“æ„
                return data;

            } catch (error) {
                console.error('è°ƒç”¨äº‘å‡½æ•°å¼‚å¸¸:', error);
                throw error;
            }
        }

        // ç¿»è¯‘å‡½æ•°
        async function translateText() {
            const text = inputText.value.trim();
            if (!text) {
                showError('è¯·è¾“å…¥è¦ç¿»è¯‘çš„æ–‡æœ¬');
                return;
            }

            showLoading('æ­£åœ¨æ£€æµ‹è¯­è¨€å¹¶ç¿»è¯‘ï¼Œè¯·ç¨å€™...');
            hideError();
            hideSuccess();

            try {
                const sourceLang = detectLanguage(text);
                updateLanguageDisplay(sourceLang, false);
                const targetLang = LANGUAGE_MAP[sourceLang].target;
                
                const result = await callCloudFunction(text, 'translate', sourceLang, targetLang);
                
                // å¤„ç†äº‘å‡½æ•°è¿”å›çš„æ ¼å¼
                if (result.body) {
                    // å¦‚æœè¿”å›äº†bodyå­—æ®µï¼Œéœ€è¦è§£æ
                    let bodyData;
                    if (typeof result.body === 'string') {
                        bodyData = JSON.parse(result.body);
                    } else {
                        bodyData = result.body;
                    }
                    
                    if (bodyData && bodyData.result) {
                        outputDisplay.textContent = bodyData.result;
                        showSuccess('ç¿»è¯‘å®Œæˆï¼');
                    } else {
                        throw new Error('è¿”å›ç»“æœæ ¼å¼é”™è¯¯: ' + JSON.stringify(result));
                    }
                } else if (result.result) {
                    // å¦‚æœç›´æ¥è¿”å›äº†resultå­—æ®µ
                    outputDisplay.textContent = result.result;
                    showSuccess('ç¿»è¯‘å®Œæˆï¼');
                } else {
                    throw new Error('è¿”å›ç»“æœæ ¼å¼é”™è¯¯: ' + JSON.stringify(result));
                }

            } catch (error) {
                console.error('ç¿»è¯‘é”™è¯¯:', error);
                showError('ç¿»è¯‘å¤±è´¥: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // è½¬è¿°å‡½æ•°
        async function paraphraseText() {
            const text = inputText.value.trim();
            if (!text) {
                showError('è¯·è¾“å…¥è¦è½¬è¿°çš„æ–‡æœ¬');
                return;
            }

            showLoading('æ­£åœ¨ä½¿ç”¨æ·±åº¦æ¨ç†æ¨¡å‹è½¬è¿°æ–‡æœ¬ï¼Œè¯·ç¨å€™...');
            hideError();
            hideSuccess();

            try {
                const sourceLang = detectLanguage(text);
                updateLanguageDisplay(sourceLang, true);
                
                const result = await callCloudFunction(text, 'paraphrase', sourceLang, sourceLang);
                
                // å¤„ç†äº‘å‡½æ•°è¿”å›çš„æ ¼å¼
                if (result.body) {
                    let bodyData;
                    if (typeof result.body === 'string') {
                        bodyData = JSON.parse(result.body);
                    } else {
                        bodyData = result.body;
                    }
                    
                    if (bodyData && bodyData.result) {
                        outputDisplay.textContent = bodyData.result;
                        showSuccess('å­¦æœ¯è½¬è¿°å®Œæˆï¼(ä½¿ç”¨æ·±åº¦æ¨ç†æ¨¡å‹)');
                    } else {
                        throw new Error('è¿”å›ç»“æœæ ¼å¼é”™è¯¯: ' + JSON.stringify(result));
                    }
                } else if (result.result) {
                    outputDisplay.textContent = result.result;
                    showSuccess('å­¦æœ¯è½¬è¿°å®Œæˆï¼(ä½¿ç”¨æ·±åº¦æ¨ç†æ¨¡å‹)');
                } else {
                    throw new Error('è¿”å›ç»“æœæ ¼å¼é”™è¯¯: ' + JSON.stringify(result));
                }

            } catch (error) {
                console.error('è½¬è¿°é”™è¯¯:', error);
                showError('è½¬è¿°å¤±è´¥: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // UIæ§åˆ¶å‡½æ•°
        function showLoading(message = 'æ­£åœ¨å¤„ç†ï¼Œè¯·ç¨å€™...') {
            loadingText.textContent = message;
            loading.style.display = 'block';
            translateBtn.disabled = true;
            paraphraseBtn.disabled = true;
        }

        function hideLoading() {
            loading.style.display = 'none';
            translateBtn.disabled = false;
            paraphraseBtn.disabled = false;
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }

        function hideError() {
            errorMessage.style.display = 'none';
        }

        function showSuccess(message) {
            successMessage.textContent = message;
            successMessage.style.display = 'block';
            setTimeout(hideSuccess, 3000);
        }

        function hideSuccess() {
            successMessage.style.display = 'none';
        }

        // äº‹ä»¶ç›‘å¬
        translateBtn.addEventListener('click', translateText);
        paraphraseBtn.addEventListener('click', paraphraseText);
        clearBtn.addEventListener('click', function() {
            inputText.value = '';
            outputDisplay.textContent = 'å¤„ç†ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...';
            inputLangText.textContent = 'ç­‰å¾…æ£€æµ‹è¾“å…¥è¯­è¨€...';
            outputLangText.textContent = 'ç­‰å¾…å¤„ç†ç»“æœ...';
            hideError();
            hideSuccess();
        });

        // å®æ—¶è¯­è¨€æ£€æµ‹ï¼ˆé˜²æŠ–å¤„ç†ï¼‰
        let detectTimeout;
        function handleInputChange() {
            clearTimeout(detectTimeout);
            const text = inputText.value.trim();
            
            if (text.length > 1) {
                detectTimeout = setTimeout(() => {
                    const detectedLang = detectLanguage(text);
                    updateLanguageDisplay(detectedLang, false);
                }, 500);
            } else {
                inputLangText.textContent = 'ç­‰å¾…æ£€æµ‹è¾“å…¥è¯­è¨€...';
                outputLangText.textContent = 'ç­‰å¾…å¤„ç†ç»“æœ...';
            }
        }

        inputText.addEventListener('input', handleInputChange);

        // å¿«æ·é”®å¤„ç†
        inputText.addEventListener('keydown', function(e) {
            // Ctrl+Enter ç¿»è¯‘
            if (e.ctrlKey && e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                translateText();
            }
            // Ctrl+Shift+Enter è½¬è¿°
            else if (e.ctrlKey && e.shiftKey && e.key === 'Enter') {
                e.preventDefault();
                paraphraseText();
            }
        });

        // é¡µé¢åŠ è½½å®Œæˆå
        window.addEventListener('load', function() {
            // å…‰æ ‡å®šä½åˆ°è¾“å…¥æ¡†
            inputText.focus();
            
            console.log('AIæ–‡å­—å¤„ç†ç³»ç»Ÿå·²åŠ è½½ï¼Œäº‘å‡½æ•°URL:', CLOUD_FUNCTION_CONFIG.HTTP_URL);
        });
    </script>
</body>
</html>